{
    "directed": true,
    "multigraph": false,
    "graph": {
        "subject_name": "Simulation",
        "func2anat_nonlinear": true
    },
    "nodes": [
        {
            "data": null,
            "complete": null,
            "bipartite": 0,
            "generated": true,
            "id": "end"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "t1_native",
            "leaf": true,
            "id": "t1"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "t1_native",
            "leaf": true,
            "id": "t1_mask"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "ds_t1_native",
            "leaf": true,
            "id": "ds_t1"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "ds_t1_native",
            "leaf": true,
            "id": "ds_t1_mask"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "ds_t1_native",
            "leaf": true,
            "id": "ds_t1_masked"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "ds_t1_native",
            "leaf": true,
            "id": "dil_ds_t1_mask"
        },
        {
            "data": [],
            "type": "surface",
            "bipartite": 0,
            "complete": false,
            "space": "t1_native",
            "leaf": true,
            "id": "white_surfs"
        },
        {
            "data": [],
            "type": "net_json",
            "complete": null,
            "bipartite": 0,
            "always_show": true,
            "leaf": true,
            "id": "sessions"
        },
        {
            "data": "/home/ssbeast/Projects/SS/monkey_fmri/MTurk1/subjects/Simulation/mri/functional_target.nii",
            "type": "volume",
            "bipartite": 0,
            "complete": null,
            "space": "epi_std",
            "leaf": true,
            "id": "functional_representative"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": null,
            "space": "epi_std",
            "leaf": true,
            "id": "functional_representative_mask"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": null,
            "space": "epi_std",
            "leaf": true,
            "id": "functional_representative_masked"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": null,
            "space": "epi_std",
            "leaf": true,
            "id": "functional_representative_dil_mask"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "ds_t1_aprox",
            "id": "manual_reg_epi_rep"
        },
        {
            "data": null,
            "type": "volume",
            "bipartite": 0,
            "complete": false,
            "space": "ds_t1_aprox",
            "id": "masked_manual_reg_epi_rep"
        },
        {
            "data": null,
            "type": "transform",
            "bipartite": 0,
            "complete": false,
            "invertable": true,
            "space": [
                "epi_std",
                "ds_t1_aprox"
            ],
            "leaf": true,
            "id": "manual_transform"
        },
        {
            "data": null,
            "type": "transform",
            "bipartite": 0,
            "complete": false,
            "invertable": false,
            "space": [
                "ds_t1_aprox",
                "ds_t1_native"
            ],
            "leaf": true,
            "id": "auto_composite_transform"
        },
        {
            "data": null,
            "type": "transform",
            "bipartite": 0,
            "complete": false,
            "invertable": false,
            "space": [
                "ds_t1_native",
                "ds_t1_aprox"
            ],
            "leaf": true,
            "id": "inverse_auto_composite_transform"
        },
        {
            "data": null,
            "complete": null,
            "bipartite": 0,
            "leaf": true,
            "id": "paradigm_complete_checkpoint"
        },
        {
            "data": {},
            "complete": null,
            "type": "label",
            "bipartite": 0,
            "leaf": true,
            "id": "surface_defined_rois"
        },
        {
            "data": {},
            "complete": null,
            "type": "volume",
            "space": "t1_native",
            "bipartite": 0,
            "leaf": true,
            "id": "volume_rois"
        },
        {
            "data": {},
            "complete": null,
            "type": "volume",
            "space": "ds_t1_native",
            "bipartite": 0,
            "leaf": true,
            "id": "ds_volume_rois"
        },
        {
            "data": {},
            "complete": null,
            "type": "volume",
            "space": "functional_std",
            "bipartite": 0,
            "leaf": true,
            "id": "functional_rois"
        },
        {
            "data": {},
            "complete": null,
            "type": "array",
            "bipartite": 0,
            "leaf": true,
            "id": "roi_time_courses"
        },
        {
            "fxn": "support_functions.load_t1_data",
            "bipartite": 1,
            "desc": "Accept user input for paths to t1 and t1 mask anatomical volumes. Used for all subject sessions",
            "id": "load_t1_data"
        },
        {
            "fxn": "support_functions.load_white_surfs",
            "bipartite": 1,
            "desc": "Accept user input for paths to white matter and cortical thickness surfaces",
            "id": "load_white_surfaces"
        },
        {
            "fxn": "support_functions.downsample_anatomical",
            "bipartite": 1,
            "desc": "Downsample orginal t1 by a factor of 2 to the working space.",
            "id": "downsample_t1"
        },
        {
            "fxn": "support_functions.downsample_anatomical",
            "bipartite": 1,
            "desc": "Downsample orginal t1 mask by a factor of 2 to the working space.",
            "id": "downsample_t1_mask"
        },
        {
            "fxn": "support_functions.apply_binary_mask_vol",
            "bipartite": 1,
            "desc": "Apply downsampled mask to downsampled t1.",
            "id": "mask_downsampled_t1"
        },
        {
            "fxn": "support_functions.apply_binary_mask_vol",
            "bipartite": 1,
            "desc": "apply a registered mask to the functional image",
            "id": "create_masked_functional_rep"
        },
        {
            "fxn": "self.create_load_session",
            "bipartite": 1,
            "desc": "create preprocessing and basic analysis pipeline for new fmri session.",
            "id": "create_load_session"
        },
        {
            "fxn": "support_functions.get_functional_target",
            "bipartite": 1,
            "desc": "get a masked functional image all sessions will preregister to",
            "modified": "2023-09-25 10:40:53.484877",
            "id": "get_functional_representative"
        },
        {
            "fxn": "support_functions.itk_manual",
            "bipartite": 1,
            "desc": "Use ITK-Snap to preform a course grain manual registration between the epi std rep volume and the downsampled t1, creating a crude linear mapping between the functional and working space. It is most important that the borders of the cortex closely match, since this map is used for  brain masking the epi rep.",
            "id": "manual_registration"
        },
        {
            "fxn": "support_functions.apply_binary_mask_vol",
            "bipartite": 1,
            "id": "apply_reg_epi_mask"
        },
        {
            "fxn": "support_functions.coreg_wrapper",
            "bipartite": 1,
            "desc": "Use ants coregistration to create a fine grained nonlinear mapping from the skull stripped manually aligned std epi rep to the downsampled t1. The manual registration got the brains as overlapping as possible, now this attempts to morph the cortex to correct differences in white matter boundaries due to field warp in epi acquisition.",
            "argv": true,
            "id": "automatic_coregistration"
        },
        {
            "fxn": "support_functions.apply_warp_inverse",
            "bipartite": 1,
            "desc": "invert the t1 mask to create a masked functional image",
            "id": "create_functional_representative_mask"
        },
        {
            "fxn": "support_functions.apply_warp_inverse",
            "bipartite": 1,
            "desc": "invert the t1 mask to create a masked functional image",
            "id": "create_dilated_functional_representative_mask"
        },
        {
            "fxn": "support_functions.dilate_mask",
            "bipartite": 1,
            "desc": "dilate the downsampled t1 mask",
            "id": "dilate_ds_t1_mask"
        },
        {
            "fxn": "self.add_paradigm_control_set",
            "bipartite": 1,
            "id": "add_new_paradigm"
        },
        {
            "fxn": "support_functions.define_surface_rois",
            "bipartite": 1,
            "desc": "Just a placeholder to tell the project manager that you created manual rois, and to provide instructions. You will need to draw and save the rois in freeview.",
            "id": "manual_surface_rois"
        },
        {
            "fxn": "support_functions.surf_labels_to_vol_mask",
            "bipartite": 1,
            "desc": "project ROIs defined on the surface back into the volume.",
            "id": "volume_rois_from_surface_rois"
        },
        {
            "fxn": "support_functions.get_vol_rois_time_series",
            "bipartite": 1,
            "desc": "Combine time series created with different stimuli orderings via block of interest stacking method, then extract the average time course for each volume roi.",
            "id": "get_vol_rois_time_series"
        },
        {
            "fxn": "support_functions.downsample_vol_rois",
            "bipartite": 1,
            "desc": "downsample volume rois by a factor of 2 to the working space.",
            "id": "downsample_vol_rois"
        },
        {
            "fxn": "support_functions.apply_warp_inverse_vol_roi_dir",
            "bipartite": 1,
            "desc": "transform directory of anatomical rois to functional space.",
            "id": "vol_2_functional_rois"
        },
        {
            "fxn": "support_functions.manual_volume_rois",
            "bipartite": 1,
            "id": "manual_volume_rois"
        },
        {
            "fxn": "self.sterilize",
            "bipartite": 1,
            "generated": true,
            "desc": "function that removes intermediate files associated with session. WARNING: This makes it impossible to re-run many intermediate processing steps without starting over.",
            "id": "sterilize"
        }
    ],
    "links": [
        {
            "order": 0,
            "source": "t1",
            "target": "downsample_t1"
        },
        {
            "order": 2,
            "source": "t1",
            "target": "volume_rois_from_surface_rois"
        },
        {
            "order": 0,
            "source": "t1_mask",
            "target": "downsample_t1_mask"
        },
        {
            "order": 0,
            "source": "ds_t1",
            "target": "mask_downsampled_t1"
        },
        {
            "order": 3,
            "source": "ds_t1",
            "target": "volume_rois_from_surface_rois"
        },
        {
            "order": 2,
            "source": "ds_t1",
            "target": "downsample_vol_rois"
        },
        {
            "order": 1,
            "source": "ds_t1",
            "target": "manual_registration"
        },
        {
            "order": 2,
            "source": "ds_t1",
            "target": "get_vol_rois_time_series"
        },
        {
            "order": 0,
            "source": "ds_t1",
            "target": "manual_volume_rois"
        },
        {
            "order": 0,
            "source": "ds_t1_mask",
            "target": "dilate_ds_t1_mask"
        },
        {
            "order": 1,
            "source": "ds_t1_mask",
            "target": "mask_downsampled_t1"
        },
        {
            "order": 0,
            "source": "ds_t1_mask",
            "target": "create_functional_representative_mask"
        },
        {
            "order": 1,
            "source": "ds_t1_masked",
            "target": "automatic_coregistration"
        },
        {
            "order": 1,
            "source": "dil_ds_t1_mask",
            "target": "apply_reg_epi_mask"
        },
        {
            "order": 0,
            "source": "dil_ds_t1_mask",
            "target": "create_dilated_functional_representative_mask"
        },
        {
            "order": 1,
            "source": "white_surfs",
            "target": "volume_rois_from_surface_rois"
        },
        {
            "order": 4,
            "source": "sessions",
            "target": "create_load_session"
        },
        {
            "order": 1,
            "source": "functional_representative",
            "target": "vol_2_functional_rois"
        },
        {
            "order": 0,
            "source": "functional_representative",
            "target": "manual_registration"
        },
        {
            "order": 1,
            "source": "functional_representative",
            "target": "create_functional_representative_mask"
        },
        {
            "order": 1,
            "source": "functional_representative",
            "target": "create_dilated_functional_representative_mask"
        },
        {
            "order": 0,
            "source": "functional_representative",
            "target": "create_masked_functional_rep"
        },
        {
            "order": 1,
            "source": "functional_representative_mask",
            "target": "create_masked_functional_rep"
        },
        {
            "order": 0,
            "source": "manual_reg_epi_rep",
            "target": "apply_reg_epi_mask"
        },
        {
            "order": 0,
            "source": "masked_manual_reg_epi_rep",
            "target": "automatic_coregistration"
        },
        {
            "order": 2,
            "source": "manual_transform",
            "target": "vol_2_functional_rois"
        },
        {
            "order": 2,
            "source": "manual_transform",
            "target": "create_functional_representative_mask"
        },
        {
            "order": 2,
            "source": "manual_transform",
            "target": "create_dilated_functional_representative_mask"
        },
        {
            "order": 3,
            "source": "inverse_auto_composite_transform",
            "target": "vol_2_functional_rois"
        },
        {
            "order": 3,
            "source": "inverse_auto_composite_transform",
            "target": "create_functional_representative_mask"
        },
        {
            "order": 3,
            "source": "inverse_auto_composite_transform",
            "target": "create_dilated_functional_representative_mask"
        },
        {
            "order": 0,
            "source": "paradigm_complete_checkpoint",
            "target": "manual_surface_rois"
        },
        {
            "order": 1,
            "source": "paradigm_complete_checkpoint",
            "target": "manual_volume_rois"
        },
        {
            "order": 1,
            "source": "surface_defined_rois",
            "target": "manual_surface_rois"
        },
        {
            "order": 0,
            "source": "surface_defined_rois",
            "target": "volume_rois_from_surface_rois"
        },
        {
            "order": 4,
            "source": "volume_rois",
            "target": "volume_rois_from_surface_rois"
        },
        {
            "order": 0,
            "source": "volume_rois",
            "target": "downsample_vol_rois"
        },
        {
            "order": 1,
            "source": "ds_volume_rois",
            "target": "downsample_vol_rois"
        },
        {
            "order": 0,
            "source": "ds_volume_rois",
            "target": "vol_2_functional_rois"
        },
        {
            "order": 0,
            "source": "ds_volume_rois",
            "target": "get_vol_rois_time_series"
        },
        {
            "order": 2,
            "source": "ds_volume_rois",
            "target": "manual_volume_rois"
        },
        {
            "order": 4,
            "source": "functional_rois",
            "target": "vol_2_functional_rois"
        },
        {
            "order": 1,
            "source": "roi_time_courses",
            "target": "get_vol_rois_time_series"
        },
        {
            "order": 0,
            "source": "load_t1_data",
            "target": "t1"
        },
        {
            "order": 1,
            "source": "load_t1_data",
            "target": "t1_mask"
        },
        {
            "order": 0,
            "source": "load_white_surfaces",
            "target": "white_surfs"
        },
        {
            "order": 0,
            "source": "downsample_t1",
            "target": "ds_t1"
        },
        {
            "order": 0,
            "source": "downsample_t1_mask",
            "target": "ds_t1_mask"
        },
        {
            "order": 0,
            "source": "mask_downsampled_t1",
            "target": "ds_t1_masked"
        },
        {
            "order": 0,
            "source": "create_masked_functional_rep",
            "target": "functional_representative_masked"
        },
        {
            "order": 0,
            "source": "create_load_session",
            "target": "sessions"
        },
        {
            "order": 1,
            "source": "create_load_session",
            "target": "end"
        },
        {
            "order": 0,
            "source": "get_functional_representative",
            "target": "functional_representative"
        },
        {
            "order": 0,
            "source": "manual_registration",
            "target": "manual_transform"
        },
        {
            "order": 1,
            "source": "manual_registration",
            "target": "manual_reg_epi_rep"
        },
        {
            "order": 0,
            "source": "apply_reg_epi_mask",
            "target": "masked_manual_reg_epi_rep"
        },
        {
            "order": 0,
            "source": "automatic_coregistration",
            "target": "auto_composite_transform"
        },
        {
            "order": 1,
            "source": "automatic_coregistration",
            "target": "inverse_auto_composite_transform"
        },
        {
            "order": 0,
            "source": "create_functional_representative_mask",
            "target": "functional_representative_mask"
        },
        {
            "order": 0,
            "source": "create_dilated_functional_representative_mask",
            "target": "functional_representative_dil_mask"
        },
        {
            "order": 0,
            "source": "dilate_ds_t1_mask",
            "target": "dil_ds_t1_mask"
        },
        {
            "order": null,
            "source": "add_new_paradigm",
            "target": "sessions"
        },
        {
            "order": null,
            "source": "add_new_paradigm",
            "target": "paradigm_complete_checkpoint"
        },
        {
            "order": 0,
            "source": "manual_surface_rois",
            "target": "surface_defined_rois"
        },
        {
            "order": 0,
            "source": "volume_rois_from_surface_rois",
            "target": "volume_rois"
        },
        {
            "order": 0,
            "source": "get_vol_rois_time_series",
            "target": "roi_time_courses"
        },
        {
            "order": 0,
            "source": "downsample_vol_rois",
            "target": "ds_volume_rois"
        },
        {
            "order": 2,
            "source": "vol_2_functional_rois",
            "target": "functional_rois"
        },
        {
            "order": 0,
            "source": "manual_volume_rois",
            "target": "ds_volume_rois"
        },
        {
            "order": 0,
            "source": "sterilize",
            "target": "end"
        }
    ]
}